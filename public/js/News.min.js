App.Components.News={Init:function(){App.Components.News.SetEventLoadMoreComments(),App.Components.News.SetEventVoteComment(),App.Components.News.SetEventReply(),App.Components.News.CommentReplyForm()},Selector:function(){return $("section.news a.showmore:not(.disabled)")},SubmitForm:function(e){var t={NewsId:$('form#Reply input[name="NewsId"]').val().trim(),ParentId:$('form#Reply input[name="ParentId"]').val().trim(),Name:$('form#Reply input[name="name"]').val().trim(),Email:$('form#Reply input[name="email"]').val().trim(),Body:$('form#Reply textarea[name="content"]').val().trim()};$.ajax({url:App.Config.Api.Comment,type:"POST",data:JSON.stringify(t),dataType:"json",contentType:"application/json",success:function(e){$("article.notification:not(.success), form#Reply").remove(),$("article.notification.success").removeClass("hide-lg hide-md hide-sm hide-xs"),$("html,body").animate({scrollTop:parseInt($("article.notification.success").offset().top)-10},1e3)}})},CommentReplyForm:function(){var e={name:"Required|Persian|Max:100",email:"Required|Email",content:"Required|Min:5|Max:1000"};App.Components.News.SetEventValidation('[data-Component-Action="News.Comment.Submit"]',"SubmitForm",e)},SetEventReply:function(){$(document).on("click","div.row.comment span.icon-reply",function(){var e=$($(this).parents(".row.comment")[0]).attr("data-id");$('form#Reply input[name="ParentId"]').val(e),$("html,body").animate({scrollTop:parseInt($("form#Reply").offset().top)-19},1e3)})},SetEventValidation:function(e,t,a){$(e).click(function(e){e.preventDefault(),e.stopPropagation(),$("form#Reply label").removeClass("invalid"),App.Library.Validator.Make(a);var s=App.Library.Validator.Passes();if(s)App.Components.News[t](!0);else{var o=App.Library.Validator.Invalids();for(var n in o)$("#"+n).closest("label").addClass("invalid")}}),$("form#Reply input, form#Reply textarea").keydown(function(e){$(this).closest("label").removeClass("invalid")})},SetEventVoteComment:function(){$(document).on("click","div.row.comment span.icon-thumbsup:not(.disable), div.row.comment span.icon-thumbsdown:not(.disable)",function(){var e=$($(this).parents(".row.comment")[0]).attr("data-Id"),t=$(this).hasClass("icon-thumbsup")?!0:!1,a={commentId:e,vote:t};$.ajax({url:App.Config.Api.CommentVote,type:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json",success:function(a){var s=t?"icon-thumbsup":"icon-thumbsdown",o=$('div.row.comment[data-id="'+e+'"] span.'+s);$(o).attr("count",parseInt($(o).attr("count"))+1),$('div.row.comment[data-id="'+e+'"] > .details span.icon-thumbsup, div.row.comment[data-id="'+e+'"] > .details span.icon-thumbsdown').text("").addClass("disable")}})})},SetEventLoadMoreComments:function(){$(App.Components.News.Selector()).click(function(){if($(this).hasClass("disabled"))return!0;var e=$(this).attr("data-NewsId"),t=$(this).attr("data-LastCommentId");App.Components.News.GetComments(e,t)})},GetComments:function(e,t){var a=App.Config.Api.CommentList.replace("[NewsId]",e).replace("[LastCommentId]",t);$.getJSON(a,function(e){App.Components.News.Process(e)})},Process:function(e){0==parseInt(e.NextComment)&&$(App.Components.News.Selector()).addClass("disabled"),App.Components.News.Render(e),$(App.Components.News.Selector()).attr("data-LastCommentId",e.Comments[e.Comments.length-1].CommentId)},Render:function(e){var t=$("#Comment").html();Mustache.parse(t);var a=Mustache.render(t,{Comments:e.Comments}),s=$(".body.no-padding > div.row.comment:not(.action)");$($(s)[s.length-1]).after(a)}},function(e){App.Components.News.Init()}(jQuery);
